import{r as o,j as e}from"./react-DuErVCKP.js";import{a as m}from"./axios-DW_MHI2K.js";m.create({baseURL:"/api",withCredentials:!1,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, PUT, POST, DELETE, PATCH, HEAD, OPTIONS","Access-Control-Allow-Headers":"*",Accept:"application/json","Content-Type":"application/json","X-Control-Tokens":"client"}});let b;async function w(){return b=(await m.get("/api/database-ui/api/database-type")).data.type,b}async function x(s,a){if(!b)throw"No db type";return(await m.post("/api/database-ui/api/sql",{sql:s,params:a})).data.data}const f=o.createContext(null),O=({children:s})=>{const[a,n]=o.useState(),[l,c]=o.useState([]),[u,t]=o.useState(),[i,h]=o.useState(),[D,T]=o.useState(),E=async()=>{const d=await w();n(d);let r=await x("SHOW DATABASES");r=r.map(p=>p.Database||p),c(r)},A=async d=>{T(void 0),t(d);let r=await x(`
            SELECT table_name FROM information_schema.tables
            WHERE table_schema = '${d}';
        `);r=r.map(p=>{var y;return p.TABLE_NAME||((y=Object.values(p))==null?void 0:y[0])||p}),h(r)},S=async d=>{T(d)};return e.jsx(f.Provider,{value:{databaseType:a,databasesList:l,loadDatabaseInfo:E,selectedDatabase:u,selectDatabase:A,selectedDatabaseTables:i,selectedTable:D,selectTable:S},children:s})},j=()=>{const s=o.useContext(f);if(!s)throw new Error("useDatabase must be used within a DatabaseProvider");return s},C=()=>{const{databaseType:s,databasesList:a,selectedDatabase:n,selectDatabase:l,selectedDatabaseTables:c,selectTable:u}=j();return e.jsxs("div",{className:"component",style:{padding:"15px",borderRadius:0,minHeight:"100dvh"},children:[e.jsxs("p",{children:["Database type: ",s]}),e.jsx("br",{}),a.map(t=>e.jsx("button",{onClick:()=>l(t),children:e.jsx("p",{children:t})},t)),e.jsx("hr",{style:{margin:"15px 0"}}),c==null?void 0:c.map(t=>e.jsx("button",{onClick:()=>u(t),children:e.jsx("p",{children:t})},t))]})};function N(s,a){return[...s].filter(l=>l.COLUMN_KEY=="PRI").map(l=>l.COLUMN_NAME).map(l=>a[l]).join("-")}const v=({database:s,table:a})=>{const[n,l]=o.useState(),[c,u]=o.useState();return o.useEffect(()=>{s&&a&&x(`
                SELECT * FROM information_schema.columns
                WHERE table_schema = '${s}' 
                AND table_name = '${a}'
            `).then(t=>{console.log(t),l(t),x(`
                    SELECT ${t.map(i=>"`"+i.COLUMN_NAME+"`").join(", ")}
                    FROM \`${s}\`.\`${a}\` LIMIT 50;
                `).then(i=>{console.log("DATA:",i),u(i)})})},[s,a]),!s||!a||!n?null:e.jsx("div",{className:"component pad-15",style:{overflow:"auto"},children:e.jsxs("table",{className:"test-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:n.map(t=>e.jsx("th",{children:t.COLUMN_NAME},t.COLUMN_NAME))})}),e.jsx("tbody",{children:c==null?void 0:c.map(t=>{const i=s+"-"+a+"-"+N(n,t);return e.jsx("tr",{children:Object.keys(t).map(h=>e.jsx("td",{children:e.jsx("p",{className:[t[h]===null&&"null"].filter(Boolean).join(" "),children:t[h]??"NULL"})},i+"-"+h))},i)})})]})})},L=()=>{const{databaseType:s,selectedDatabase:a,selectedTable:n}=j();return e.jsxs("div",{className:"db-viewer-page",style:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsx("div",{className:"component pad-15",children:a?n?e.jsxs("p",{children:[s," / ",a," / ",n]}):e.jsxs("p",{children:[s," / ",a]}):e.jsx("p",{children:s})}),e.jsx(v,{database:a,table:n},a+"-"+n)]})};function _(){const{databaseType:s,loadDatabaseInfo:a}=j();return o.useEffect(()=>{a()},[]),s?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"200px 1fr"},children:[e.jsx(C,{}),e.jsx("div",{className:"page-view",style:{overflowX:"hidden",overflowY:"auto",width:"100%",height:"100dvh",padding:"15px",display:"flex",flexDirection:"column"},children:e.jsx(L,{})})]}):e.jsx("div",{children:e.jsx("p",{children:"Loading..."})})}export{_ as A,O as D};
